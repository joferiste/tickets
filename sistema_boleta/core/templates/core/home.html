{% extends "core/base.html" %}
{% load custom_filters %}

{% load static %}

{% block title  %} Home {% endblock %}

{% block content %}

<!-- Contenido Principal -->
<div class="main-content">
    <div class="content-wrapper">
        <div class="locales-mapa">
            {% for i in "12345678" %}
                {% with local=locales|get_local:i %}
                    {% if local %}
                        {% with ocupacion=ocupaciones|get_ocupacion:local.idLocal %}
                            <a href="{% url 'locales:perfil_local' local.idLocal %}" 
                                class="local local-{{ i }} {{ local.estado.nombre|lower }}"
                                {% if ocupacion %} data-negocio="{{ ocupacion.negocio.nombre }}" {% endif %}>
                            
                                <span class="badge-position">{{ i }}</span>
                                {{ local.nombre }}
                            
                                <div class="tooltip">
                                    <h3>{{ local.nombre|default:"Local sin nombre" }}</h3>
                                    
                                
                                    {% if ocupacion %}
                                        <strong>Negocio:</strong> {{ ocupacion.negocio.nombre }}<br>
                                        <strong>Inicio:</strong> {{ ocupacion.fecha_inicio|date:"d/m/Y" }}<br>
                                    {% endif %}
                                
                                    <strong>Estado: </strong>{{ local.estado }}
                                </div>
                            </a>
                        {% endwith %}
                    {% else %}
                        {# Local no existe en la BD #}
                        <div class="local local-{{ i }} disponible">
                            <span class="badge-position">{{ i }}</span>
                            Local {{ i }}
                            
                            <div class="tooltip">
                                <h3>Local {{ i }}</h3>
                                <strong>Estado:</strong> No asignado
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}
            {% endfor %}
        </div>
        

        <!-- Panel derecho: Negocios -->
        <div class="right-panel">
            <h3>Negocios Activos</h3>
            <div class="business-item">
                {% for negocio in negocios %}
                    <div class="business-name" data-negocio="{{ negocio.nombre }}">
                        <a href="{% url 'negocios:perfil_negocio' negocio.idNegocio %}">
                            <div class="only-name">{{ negocio.nombre }}</div>
                            <div class="responsably-name">{{ negocio.usuario.nombre }}</div>
                        </a>
                    </div>
                {% empty %}
                    <p style="text-align: center; color: #999; padding: 2rem 0;">
                        No hay negocios registrados
                    </p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Leyenda de estados -->
<div class="legend">
    <div class="legend-item">
        <div class="legend-color legend-disponible"></div>
        <span>Disponible</span>
    </div>
    <div class="legend-item">
        <div class="legend-color legend-ocupado"></div>
        <span>Ocupado</span>
    </div>
</div>
{% endblock %}
