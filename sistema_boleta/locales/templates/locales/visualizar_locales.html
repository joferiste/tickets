{% extends "core/base.html" %}
{% load static %}

{% block title %} Visualizaci√≥n de Locales {% endblock %}
{% block page_title %} Visualizaci√≥n de Local {% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'locales/css/design_update.css' %}">
<script src="{% static 'locales/js/scriptsUpdate.js' %}"></script>

<div class="main-content">
    <div class="container-locales">
        <!-- Header con t√≠tulo y b√∫squeda -->
        <div class="header-section">
            <div class="header-left">
                <h1 class="page-title-1"> Gesti√≥n de locales</h1>
                <p class="page-subtitle">Administra y consulta los locales del sistema</p>
            </div>
            <div class="header-right">
                <form method="POST" class="form-busqueda">
                    {% csrf_token %}
                    <div class="search-wrapper">
                        {{ form.q }}
                        <button type="submit" class="btn-buscar">
                            <span class="icon">üîç</span>
                            <span class="text">Buscar</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabla de resultados -->
        <div class="tabla-wrapper">
            {% if locales %}
                <!-- Informaci√≥n de paginaci√≥n -->
                <div class="pagination-info">
                    <span class="info-text">
                        Mostrando {{ locales.start_index }} - {{ locales.end_index }} de {{ total_locales }} locales
                    </span>
                </div>

                <div class="tabla-container">
                    <table class="tabla-locales">
                        <thead>
                            <tr>
                                <th>Local</th>
                                <th>Posici√≥n</th>
                                <th>Nivel</th>
                                <th>Estado</th>
                                <th>Costo</th>
                                <th>Fecha Ingreso</th>
                                <th class="th-acciones">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for local in locales %}
                            <tr id="local-{{ local.idLocal }}" class="fila-local">
                                <td class="nombre" data-label="Local">
                                    <div class="local-info">
                                        <div class="local-avatar">{{ local.nombre|first|upper }}</div>
                                        <div class="local-detalles">
                                            <span class="local-nombre">{{ local.nombre }}</span>
                                            <span class="local-ubicacion">{{ local.ubicacion|default:"Sin ubicaci√≥n" }}</span>
                                        </div>
                                    </div>
                                </td>
                                <td class="posicion" data-label="Posici√≥n">
                                    {% if local.posicionMapa %}
                                        <span class="badge badge-posicion">Posici√≥n {{ local.posicionMapa }}</span>
                                    {% else %}
                                        <span class="badge badge-sin-posicion">Sin asignar</span>
                                    {% endif %}
                                </td>
                                <td class="nivel" data-label="Nivel">
                                    {{ local.nivel }}
                                </td>
                                <td class="estado" data-label="Estado">
                                    <span class="badge badge-{{ local.estado.nombre|lower }}">
                                        {{ local.estado }}
                                    </span>
                                </td>
                                <td class="costo" data-label="Costo">
                                    <span class="precio">Q. {{ local.costo|floatformat:".2f" }}</span>
                                </td>
                                <td class="fechaCreacion" data-label="fechaCreacion">
                                    <span class="fecha"> {{ local.fechaCreacion|date:"d/m/Y" }}</span>
                                </td>
                                <td class="acciones" data-label="Acciones">
                                    <div class="btn-group">
                                        <button class="btn-action btn-edit" 
                                                title="Editar local" 
                                                onclick="openEditModalLocal({{ local.idLocal }})">
                                            <span class="icon">‚úèÔ∏è</span>
                                        </button>
                                        <button class="btn-action btn-delete" 
                                                title="Eliminar local" 
                                                onclick="openDeleteModal({{ local.idLocal }}, '{{ local.nombre|escapejs }}')">
                                            <span class="icon">üóëÔ∏è</span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Controles de paginaci√≥n -->
                {% if locales.has_other_pages %}
                <div class="pagination-controls">
                    <div class="pagination-buttons">
                        {% if locales.has_previous %}
                            <a href="?page=1{% if request.POST.q %}&q={{ request.POST.q }}{% endif %}" class="btn-page btn-page-first" title="Primera p√°gina">
                                <span>¬´</span>
                            </a>
                            <a href="?page={{ locales.previous_page_number }}{% if request.POST.q %}&q={{ request.POST.q }}{% endif %}" class="btn-page btn-page-prev" title="P√°gina anterior">
                                <span>‚Äπ</span>
                            </a>
                        {% else %}
                            <span class="btn-page btn-page-disabled">¬´</span>
                            <span class="btn-page btn-page-disabled">‚Äπ</span>
                        {% endif %}

                        <div class="page-numbers">
                            {% for num in locales.paginator.page_range %}
                                {% if locales.number == num %}
                                    <span class="btn-page btn-page-current">{{ num }}</span>
                                {% elif num > locales.number|add:'-3' and num < locales.number|add:'3' %}
                                    <a href="?page={{ num }}{% if request.POST.q %}&q={{ request.POST.q }}{% endif %}" class="btn-page">{{ num }}</a>
                                {% endif %}
                            {% endfor %}
                        </div>

                        {% if locales.has_next %}
                            <a href="?page={{ locales.next_page_number }}{% if request.POST.q %}&q={{ request.POST.q }}{% endif %}" class="btn-page btn-page-next" title="P√°gina siguiente">
                                <span>‚Ä∫</span>
                            </a>
                            <a href="?page={{ locales.paginator.num_pages }}{% if request.POST.q %}&q={{ request.POST.q }}{% endif %}" class="btn-page btn-page-last" title="√öltima p√°gina">
                                <span>¬ª</span>
                            </a>
                        {% else %}
                            <span class="btn-page btn-page-disabled">‚Ä∫</span>
                            <span class="btn-page btn-page-disabled">¬ª</span>
                        {% endif %}
                    </div>

                    <div class="pagination-summary">
                        P√°gina {{ locales.number }} de {{ locales.paginator.num_pages }}
                    </div>
                </div>
                {% endif %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üîç</div>
                    <h3>No se encontraron locales</h3>
                    <p>Intenta ajustar los criterios de b√∫squeda</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Modal Editar -->
    <div class="modal" id="modal" aria-hidden="true">
        <div class="modal-backdrop" onclick="openDeleteModalLocal('modal')"></div>
        <div class="modal-content" id="modal-content"></div>
    </div>

    <!-- Modal Eliminar -->
    <div id="deleteModal" class="modal" aria-hidden="true">
        <div class="modal-backdrop" onclick="closeModal('deleteModal')"></div>
        <div class="modal-content modal-eliminar">
            <div class="modal-header">
                <h3>‚ö†Ô∏è Confirmar Eliminaci√≥n</h3>
            </div>
            <form method="POST" action="{% url 'locales:delete_local' %}">
                {% csrf_token %}
                <input type="hidden" name="id" id="delete_id">
                <p id="delete_text" class="delete-message"></p>
                <div class="modal-actions">
                    <button type="button" onclick="closeModal('deleteModal')" class="btn-modal btn-cancel">
                        Cancelar
                    </button>
                    <button type="submit" class="btn-modal btn-delete-confirm">
                        Eliminar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}