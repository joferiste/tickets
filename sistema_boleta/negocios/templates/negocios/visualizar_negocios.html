{% extends 'core/base.html' %}
{% load static %}

{% block title %} Visualizaci√≥n de Negocios {% endblock %}
{% block page_title %} Visualizaci√≥n de Negocio {% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'negocios/css/design_update.css' %}">
<script src="{% static 'negocios/js/scriptsUpdate.js' %}"></script>

<div class="main-content">
    <div class="container-negocios">
        <!-- Header con t√≠tulo y b√∫squeda -->
        <div class="header-section">
            <div class="header-left">
                <h1 class="page-title-1">Gesti√≥n de negocios</h1>
                <p class="page-subtitle">Administra y consulta los negocios del sistema</p>
            </div>
            <div class="header-right">
                <form method="POST" class="form-busqueda">
                    {% csrf_token %}
                    <div class="search-wrapper">
                        {{ form.q }}
                        <button type="submit" class="btn-buscar">
                            <span class="icon">üîç</span>
                            <span class="text">Buscar</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabla de resultados -->
        <div class="tabla-wrapper">
            {% if negocios %}
                <!-- Informaci√≥n de paginaci√≥n -->
                <div class="pagination-info">
                    <span class="info-text">
                        Mostrando {{ negocios.start_index }} - {{ negocios.end_index }} de {{ total_negocios }} negocios
                    </span>
                </div>

                <div class="tabla-container">
                    <table class="tabla-negocios">
                        <thead>
                            <tr>
                                <th>Negocio</th>
                                <th>Categor√≠a</th>
                                <th>Propietario</th>
                                <th>Contacto</th>
                                <th>Estado</th>
                                <th>Fecha Registro</th>
                                <th class="th-acciones">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for negocio in negocios %}
                            <tr id="negocio-{{ negocio.idNegocio }}" class="fila-negocio">
                                <td class="nombre" data-label="Negocio">
                                    <div class="negocio-info">
                                        <div class="negocio-avatar">{{ negocio.nombre|first|upper }}</div>
                                        <div class="negocio-detalles">
                                            <span class="negocio-nombre">{{ negocio.nombre }}</span>
                                            <span class="negocio-desc">
                                                {% if negocio.descripcion %}
                                                    <div class="italic">{{ negocio.descripcion|truncatewords:6 }}</div>
                                                {% else %}
                                                    <div class="italic">-- Sin descripci√≥n --</div>
                                                {% endif %}
                                            </span>
                                        </div>
                                    </div>
                                </td>
                                <td class="categoria" data-label="Categor√≠a">
                                    <span class="badge badge-categoria">{{ negocio.categoria }}</span>
                                </td>
                                <td class="usuario" data-label="Propietario">
                                    {{ negocio.usuario.nombre }}
                                </td>
                                <td class="contacto" data-label="Contacto">
                                    <div class="contacto-info">
                                        <span class="telefono1">üìû {{ negocio.telefono1 }}</span>
                                        {% if negocio.email %}
                                        <span class="email">‚úâÔ∏è {{ negocio.email }}</span>
                                        {% endif %}
                                    </div>
                                </td>
                                <td class="estado" data-label="Estado">
                                    <span class="badge badge-{{ negocio.estado|lower }}">
                                        {{ negocio.estado }}
                                    </span>
                                </td>
                                <td class="fechaCreacion" data-label="Fecha">
                                    {{ negocio.fechaCreacion|date:"d/m/Y" }}
                                </td>
                                <td class="acciones" data-label="Acciones">
                                    <div class="btn-group">
                                        <button class="btn-action btn-edit" 
                                                title="Editar negocio" 
                                                onclick="openEditModalNegocio({{ negocio.idNegocio }})">
                                            <span class="icon">‚úèÔ∏è</span>
                                        </button>
                                        <button class="btn-action btn-delete" 
                                                title="Eliminar negocio" 
                                                onclick="openDeleteModal({{ negocio.idNegocio }}, '{{ negocio.nombre }}')">
                                            <span class="icon">üóëÔ∏è</span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Controles de paginaci√≥n -->
                {% if negocios.has_other_pages %}
                <div class="pagination-controls">
                    <div class="pagination-buttons">
                        {% if negocios.has_previous %}
                            <a href="?page=1{% if request.POST.q %}&q={{ request.POST.q }}{% endif %}" class="btn-page btn-page-first" title="Primera p√°gina">
                                <span>¬´</span>
                            </a>
                            <a href="?page={{ negocios.previous_page_number }}{% if request.POST.q %}&q={{ request.POST.q }}{% endif %}" class="btn-page btn-page-prev" title="P√°gina anterior">
                                <span>‚Äπ</span>
                            </a>
                        {% else %}
                            <span class="btn-page btn-page-disabled">¬´</span>
                            <span class="btn-page btn-page-disabled">‚Äπ</span>
                        {% endif %}

                        <div class="page-numbers">
                            {% for num in negocios.paginator.page_range %}
                                {% if negocios.number == num %}
                                    <span class="btn-page btn-page-current">{{ num }}</span>
                                {% elif num > negocios.number|add:'-3' and num < negocios.number|add:'3' %}
                                    <a href="?page={{ num }}{% if request.POST.q %}&q={{ request.POST.q }}{% endif %}" class="btn-page">{{ num }}</a>
                                {% endif %}
                            {% endfor %}
                        </div>

                        {% if negocios.has_next %}
                            <a href="?page={{ negocios.next_page_number }}{% if request.POST.q %}&q={{ request.POST.q }}{% endif %}" class="btn-page btn-page-next" title="P√°gina siguiente">
                                <span>‚Ä∫</span>
                            </a>
                            <a href="?page={{ negocios.paginator.num_pages }}{% if request.POST.q %}&q={{ request.POST.q }}{% endif %}" class="btn-page btn-page-last" title="√öltima p√°gina">
                                <span>¬ª</span>
                            </a>
                        {% else %}
                            <span class="btn-page btn-page-disabled">‚Ä∫</span>
                            <span class="btn-page btn-page-disabled">¬ª</span>
                        {% endif %}
                    </div>

                    <div class="pagination-summary">
                        P√°gina {{ negocios.number }} de {{ negocios.paginator.num_pages }}
                    </div>
                </div>
                {% endif %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üîç</div>
                    <h3>No se encontraron negocios</h3>
                    <p>Intenta ajustar los criterios de b√∫squeda</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Modal Editar -->
    <div id="modal" class="modal" aria-hidden="true">
        <div class="modal-backdrop" onclick="openDeleteModalNegocio('modal')"></div>
        <div class="modal-content" id="modal-content"></div>
    </div>

    <!-- Modal Eliminar -->
    <div id="deleteModal" class="modal" aria-hidden="true">
        <div class="modal-backdrop" onclick="closeModal('deleteModal')"></div>
        <div class="modal-content modal-eliminar">
            <div class="modal-header">
                <h3>‚ö†Ô∏è Confirmar Eliminaci√≥n</h3>
            </div>
            <form method="POST" action="{% url 'negocios:delete_negocio' %}">
                {% csrf_token %}
                <input type="hidden" name="id" id="delete_id">
                <p id="delete_text" class="delete-message"></p>
                <div class="modal-actions">
                    <button type="button" onclick="closeModal('deleteModal')" class="btn-modal btn-cancel">
                        Cancelar
                    </button>
                    <button type="submit" class="btn-modal btn-delete-confirm">
                        Eliminar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}