{% extends "core/base.html" %}
{% load static %}

{% block title %} Visualizaci√≥n de Usuarios {% endblock %}
{% block page_title %} Visualizaci√≥n de Usuario {% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'usuarios/css/design_update.css' %}">
<script src="{% static 'usuarios/js/scriptsUpdate.js' %}"></script>

<div class="main-content">
    <div class="container-usuarios">
        <!-- Header con t√≠tulo y b√∫squeda -->
        <div class="header-section">
            <div class="header-left">
                <h1 class="page-title-1">Gesti√≥n de usuarios</h1>
                <p class="page-subtitle">Administra y consulta los usuarios del sistema</p>
            </div>
            <div class="header-right">
                <form method="POST" class="form-busqueda">
                    {% csrf_token %}
                    <div class="search-wrapper">
                        {{ form.q }}
                        <button type="submit" class="btn-buscar">
                            <span class="icon">üîç</span>
                            <span class="text">Buscar</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabla de resultados -->
        <div class="tabla-wrapper">
            {% if usuarios %}
                <!-- Informaci√≥n de paginaci√≥n -->
                <div class="pagination-info">
                    <span class="info-text">
                        Mostrando {{ usuarios.start_index }} - {{ usuarios.end_index }} de {{ total_usuarios }} usuarios
                    </span>
                </div>

                <div class="tabla-container">
                    <table class="tabla-usuarios">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Direcci√≥n</th>
                                <th>Tel√©fono</th>
                                <th>Correo</th>
                                <th>Estado</th>
                                <th>Fecha Ingreso</th>
                                <th class="th-acciones">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for usuario in usuarios %}
                            <tr id="usuario-{{ usuario.idUsuario }}" class="fila-usuario">
                                <td class="nombre" data-label="Nombre">
                                    <div class="usuario-info">
                                        <div class="usuario-avatar">{{ usuario.nombre|first|upper }}</div>
                                        <div class="usuario-detalles">
                                            <span class="usuario-nombre">{{ usuario.nombre }}</span>
                                            <span class="usuario-dpi">DPI: {{ usuario.dpi|default:"---" }}</span>
                                        </div>
                                    </div>
                                </td>
                                <td class="direccion" data-label="Direccion">{{ usuario.direccionCompleta }}</td>
                                <td class="telefono1" data-label="Tel√©fono">
                                    <div class="telefono-info">
                                        <span>{{ usuario.telefono1 }}</span>
                                        {% if usuario.telefono2 %}
                                        <span class="telefono-alt">{{ usuario.telefono2 }}</span>
                                        {% endif %}
                                    </div>
                                </td>
                                <td class="email" data-label="Correo">
                                    {{ usuario.email|default:"---" }}
                                </td>
                                <td class="estado" data-label="Estado">
                                    <span class="badge badge-{{ usuario.estado|lower }}">
                                        {{ usuario.estado }}
                                    </span>
                                </td>
                                <td class="fechaCreacion" data-label="Fecha">
                                    {{ usuario.fechaCreacion|date:"d/m/Y" }}
                                </td>
                                <td class="acciones" data-label="Acciones">
                                    <div class="btn-group">
                                        <button class="btn-action btn-edit" 
                                                title="Editar usuario" 
                                                onclick="openEditModalUsuario({{ usuario.idUsuario }})">
                                            <span class="icon">‚úèÔ∏è</span>
                                        </button>
                                        <button class="btn-action btn-delete" 
                                                title="Eliminar usuario" 
                                                onclick="openDeleteModal({{ usuario.idUsuario }}, '{{ usuario.nombre }}')">
                                            <span class="icon">üóëÔ∏è</span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            
                            <!-- Fila expandible con informaci√≥n adicional (opcional) -->
                            <tr class="fila-detalle hidden" id="detalle-{{ usuario.idUsuario }}">
                                <td colspan="7">
                                    <div class="detalle-usuario">
                                        <div class="detalle-item">
                                            <strong>Fecha Nacimiento:</strong>
                                            <span>{{ usuario.fechaNacimiento|date:"d/m/Y"|default:"---" }}</span>
                                        </div>
                                        <div class="detalle-item">
                                            <strong>Direcci√≥n:</strong>
                                            <span>{{ usuario.direccionCompleta }}</span>
                                        </div>
                                        <div class="detalle-item">
                                            <strong>Tel√©fono 2:</strong>
                                            <span class="telefono2">{{ usuario.telefono2|default:"---" }}</span>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üîç</div>
                    <h3>No se encontraron usuarios</h3>
                    <p>Intenta ajustar los criterios de b√∫squeda</p>
                </div>
            {% endif %}

            {% if usuarios.has_other_pages %}
            <div class="pagination-controls">
                <div class="pagination-buttons">
                    {% if usuarios.has_previous %}
                        <a href="?page=1{% if request.POST.q %}&q={{ request.POST.q }}{% endif %}" class="btn-page btn-page-first" title="Primera p√°gina">
                            <span>¬´</span>
                        </a>
                        <a href="?page={{ usuarios.previous_page_number }}{% if request.POST.q %}&q={{ request.POST.q }}{% endif %}" class="btn-page btn-page-prev" title="P√°gina anterior">
                            <span>‚Äπ</span>
                        </a>
                    {% else %}
                        <span class="btn-page btn-page-disabled">¬´</span>
                        <span class="btn-page btn-page-disabled">‚Äπ</span>
                    {% endif %}

                    <!-- N√∫meros de p√°gina -->
                    <div class="page-numbers">
                        {% for num in usuarios.paginator.page_range %}
                            {% if usuarios.number == num %}
                                <span class="btn-page btn-page-current">{{ num }}</span>
                            {% elif num > usuarios.number|add:'-3' and num < usuarios.number|add:'3' %}
                                <a href="?page={{ num }}{% if request.POST.q %}&q={{ request.POST.q }}{% endif %}" class="btn-page">{{ num }}</a>
                            {% endif %}
                        {% endfor %}
                    </div>

                    {% if usuarios.has_next %}
                        <a href="?page={{ usuarios.next_page_number }}{% if request.POST.q %}&q={{ request.POST.q }}{% endif %}" class="btn-page btn-page-next" title="P√°gina siguiente">
                            <span>‚Ä∫</span>
                        </a>
                        <a href="?page={{ usuarios.paginator.num_pages }}{% if request.POST.q %}&q={{ request.POST.q }}{% endif %}" class="btn-page btn-page-last" title="√öltima p√°gina">
                            <span>¬ª</span>
                        </a>
                    {% else %}
                        <span class="btn-page btn-page-disabled">‚Ä∫</span>
                        <span class="btn-page btn-page-disabled">¬ª</span>
                    {% endif %}
                </div>

                <div class="pagination-summary">
                    P√°gina {{ usuarios.number }} de {{ usuarios.paginator.num_pages }}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Modal Editar -->
    <div class="modal" id="modal" aria-hidden="true">
        <div class="modal-backdrop" onclick="openDeleteModalUsuario('modal')"></div>
        <div class="modal-content" id="modal-content"></div>
    </div>
  
    <!-- Modal Eliminar -->
    <div id="deleteModal" class="modal" aria-hidden="true">
        <div class="modal-backdrop" onclick="closeModal('deleteModal')"></div>
        <div class="modal-content modal-eliminar">
            <div class="modal-header">
                <h3>‚ö†Ô∏è Confirmar Eliminaci√≥n</h3>
            </div>
            <form method="POST" action="{% url 'usuarios:delete_usuario' %}">
                {% csrf_token %}
                <input type="hidden" name="id" id="delete_id">
                <p id="delete_text" class="delete-message"></p>
                <div class="modal-actions">
                    <button type="button" onclick="closeModal('deleteModal')" class="btn-modal btn-cancel">
                        Cancelar
                    </button>
                    <button type="submit" class="btn-modal btn-delete-confirm">
                        Eliminar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}  